# Архитектура

[Английская версия](ARCHITECTURE.md)

## Сайт

## Телеграм бот

На данный момент возможна обработка 3 типов update’ов от телеграма:
* Message
* CallbackQuery
* Location

Роутингом каждого типа update’а отвечает класс CommandRouteResolver. При помощи классов, наследуемых от интерфейса IRequestHandler, он получает строку, исходя из которой он может получить путь к нужному контроллеру. На каждый тип update’а существует свой RequestHandler.

Например, для Message это MessageRequestHandler, который получает строку из поля text.
CallbackQueryRequestHandler получает эту строку из поля data объекта CallbackQuery.
LocationRequestHandler просто возвращает константу, если в апдейте содержится Location.

Если вы захотите добавить обработку, например, аудио, то вам нужно создать класс AudioRequestHandler и соответствующе реализовать его.

После того, как CommandRouteResolver вернул роут, Module создает соответствующий контроллер и запускает action. Все action’ы контроллеров должны возвращать массив объектов, наследуемых от класса Command. После выполнения action’а, Module отправит каждую команду. 

Класс Command - это просто класс, который знает о том, как отправить определенный запрос в телеграм.

Например, существует SendMessageCommand, который отправляет запрос /sendMessage... для отправки сообщения пользователю. Опять же, если вам понадобиться делать новый запрос, то нужно создавать новый класс, наследуемый от класса Command.

У самого модуля существует четыре поля, которые идентифицируют пользователя и могут вам пригодиться: update, user, telegramUser и telegramChat. Для простоты доступа, в базовом классе контроллеров определены методы для получение данных полей.

Контроллеры на данный момент разделяются на публичные (папка publics), которые вызываются при обработке команд из групп, и приватные (папка privates),которые вызываются от при обработке команд из личной переписки пользователя с ботом. Вьюхи разделены аналогично.
